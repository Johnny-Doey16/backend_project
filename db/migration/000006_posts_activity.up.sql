CREATE TABLE "post_comments" (
  "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "user_id" uuid not null,
  "post_id" uuid not null,
  "comment_text" varchar not null,
  "created_at" timestamptz DEFAULT (now()),
  "updated_at" timestamptz
);

CREATE TABLE "posts_metrics" (
  "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "post_id" uuid NOT NULL,
  "views" int DEFAULT 0,
  "likes" int DEFAULT 0,
  "comments" int DEFAULT 0,
  "reposts" int DEFAULT 0
);

CREATE TABLE "repost" (
  "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "user_id" uuid not null,
  "original_post_id" uuid not null,
  "created_at" timestamptz DEFAULT (now())
);

CREATE TABLE "likes" (
  "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "user_id" uuid NOT NULL,
  "post_id" uuid NOT NULL
);

CREATE TABLE "post_views" (
  "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "user_id" uuid NOT NULL,
  "post_id" uuid NOT NULL
);

CREATE TABLE "post_mentions" (
  "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "post_id" uuid not null,
  "mentioned_user_id" uuid not null
);

CREATE INDEX ON "post_comments" ("user_id", "id", "post_id");

CREATE INDEX ON "likes" ("user_id", "post_id");

CREATE INDEX ON "post_views" ("user_id", "post_id");

CREATE INDEX ON "repost" ("user_id", "id", "original_post_id");

CREATE INDEX ON "post_mentions" ("post_id", "mentioned_user_id");

CREATE INDEX ON "posts_metrics" ("post_id","views","likes","comments","reposts");

CREATE UNIQUE INDEX likes_user_id_post_id_idx ON likes (user_id, post_id);

CREATE UNIQUE INDEX post_views_user_id_post_id_idx ON post_views (user_id, post_id);

ALTER TABLE "post_comments" ADD FOREIGN KEY ("user_id") REFERENCES "authentications" ("id");
ALTER TABLE "post_comments" ADD FOREIGN KEY ("post_id") REFERENCES "posts" ("id");

ALTER TABLE "repost" ADD FOREIGN KEY ("user_id") REFERENCES "authentications" ("id");

ALTER TABLE "repost" ADD FOREIGN KEY ("original_post_id") REFERENCES "posts" ("id");

ALTER TABLE "repost" ADD CONSTRAINT unique_uid_org_post_id UNIQUE ("user_id", "original_post_id");

ALTER TABLE "likes" ADD FOREIGN KEY ("user_id") REFERENCES "authentications" ("id");

ALTER TABLE "likes" ADD FOREIGN KEY ("post_id") REFERENCES "posts" ("id");

ALTER TABLE "post_views" ADD FOREIGN KEY ("user_id") REFERENCES "authentications" ("id");

ALTER TABLE "post_views" ADD FOREIGN KEY ("post_id") REFERENCES "posts" ("id");


ALTER TABLE "post_mentions" ADD FOREIGN KEY ("post_id") REFERENCES "posts" ("id");

ALTER TABLE "post_mentions" ADD FOREIGN KEY ("mentioned_user_id") REFERENCES "authentications" ("id");

ALTER TABLE "post_mentions" ADD CONSTRAINT unique_user_per_post_mentions UNIQUE (post_id, mentioned_user_id);

ALTER TABLE "posts_metrics" ADD FOREIGN KEY ("post_id") REFERENCES "posts" ("id");